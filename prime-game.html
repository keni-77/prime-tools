<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ç´ æ•°ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</title>
<link rel="icon" href="ğŸŒ¸M.png">
<style>
  body {
    background: #fff5f8;
    font-family: "Hiragino Maru Gothic ProN", "Yu Gothic", sans-serif;
    text-align: center;
    padding-top: 20px;
  }

  h1 {
    color: #ff7aa8;
  }

  #gameArea {
    width: 300px;
    height: 400px;
    background: snow;
    margin: 20px auto;
    border-radius: 15px;
    box-shadow: 0 4px 12px rgba(255,150,180,0.4);
    position: relative;
    overflow: hidden;
  }

  .enemy {
    position: absolute;
    top: -40px;
    left: 0;
    width: 60px;
    height: 40px;
    background: #ffe0ef;
    border-radius: 10px;
    color: #ff4f9a;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(255,150,180,0.4);
  }

  #score, #miss {
    font-size: 1.4rem;
    color: hotpink;
  }
</style>
</head>
<body>

<h1>ğŸŒ¸ ç´ æ•°ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ğŸŒ¸</h1>

<div id="score">ã‚¹ã‚³ã‚¢: 0</div>
<div id="miss">ãƒŸã‚¹: 0 / 3</div>

<div id="gameArea"></div>

<script>
function isPrime(n) {
  if (n < 2) return false;
  if (n === 2) return true;
  if (n % 2 === 0) return false;
  const r = Math.floor(Math.sqrt(n));
  for (let i = 3; i <= r; i += 2) {
    if (n % i === 0) return false;
  }
  return true;
}

const gameArea = document.getElementById("gameArea");
let score = 0;
let miss = 0;

// â˜… åŒæ™‚ã«å‡ºã›ã‚‹æ•µã®æœ€å¤§æ•°
const MAX_ENEMIES = 5;

// â˜… ç¾åœ¨ã®æ•µã®æ•°
let enemyCount = 0;

// â˜… ãƒ¬ãƒ™ãƒ«ã¨é€Ÿåº¦
let level = 1;
let fallSpeed = 2;          // è½ä¸‹é€Ÿåº¦
let spawnInterval = 1000;   // å‡ºç¾é–“éš”(ms)

// â˜… ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦ç´ æ•°ç‡ã‚’ä¸Šã’ã‚‹
function getPrimeRate() {
  return Math.min(0.3 + (level - 1) * 0.1, 0.8); 
}

function levelUp() {
  level++;
  fallSpeed += 0.5;          
  spawnInterval = Math.max(300, spawnInterval - 100);
}

function spawnEnemy() {
  if (enemyCount >= MAX_ENEMIES) return;

  enemyCount++;

  const enemy = document.createElement("div");
  enemy.classList.add("enemy");

  // â˜… ç´ æ•°ç‡ã‚’ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦å¤‰ãˆã‚‹
  let num;
  if (Math.random() < getPrimeRate()) {
    // ç´ æ•°ã‚’å‡ºã™
    do {
      num = Math.floor(Math.random() * 200) + 1;
    } while (!isPrime(num));
  } else {
    // åˆæˆæ•°ã‚’å‡ºã™
    do {
      num = Math.floor(Math.random() * 200) + 1;
    } while (isPrime(num));
  }

  enemy.textContent = num;
  enemy.style.left = Math.floor(Math.random() * 240) + "px";
  gameArea.appendChild(enemy);

  let y = -40;
  const fall = setInterval(() => {
    y += fallSpeed;
    enemy.style.top = y + "px";

    if (y > 400) {
      clearInterval(fall);
      enemy.remove();
      enemyCount--;

      if (isPrime(num)) {
        miss++;
        updateMiss();
      }
    }
  }, 20);

  enemy.onclick = () => {
    clearInterval(fall);
    enemy.remove();
    enemyCount--;

    if (isPrime(num)) {
      score++;
      document.getElementById("score").textContent = "ã‚¹ã‚³ã‚¢: " + score;

      if (score % 10 === 0) {
        levelUp();
      }

    } else {
      miss++;
      updateMiss();
    }
  };
}

function updateMiss() {
  document.getElementById("miss").textContent = `ãƒŸã‚¹: ${miss} / 3`;
  if (miss >= 3) {
    alert(`ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼ ã‚¹ã‚³ã‚¢: ${score}`);
    location.reload();
  }
}

// â˜… å‡ºç¾é–“éš”ãŒå¤‰ã‚ã‚‹ã®ã§ setInterval ã§ã¯ãªããƒ«ãƒ¼ãƒ—ã§ç®¡ç†
function gameLoop() {
  spawnEnemy();
  setTimeout(gameLoop, spawnInterval);
}

gameLoop();
</script>

</body>
</html>
