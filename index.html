<!DOCTYPE html>
<html lang="ja">
<head>
  <meta name="description" content="ç´ å› æ•°åˆ†è§£ã€nç•ªç›®ã®ç´ æ•°ã€nä»¥ä¸‹ã®ç´ æ•°ã®å€‹æ•°ã‚’é«˜é€Ÿã§è¨ˆç®—ã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚">
  <meta charset="UTF-8">
  <title>Prime</title>
  <link rel="icon" href="ğŸŒ¸M.png">

  <style>
    body {
      background-color: #fff5f8;
      font-family: "Hiragino Maru Gothic ProN", "Yu Gothic", sans-serif;
      text-align: center;
      padding-top: 50px;
      color: #444;
    }

    h2 {
      color: #ff7aa8;
      font-size: 2rem;
      margin-bottom: 20px;
    }

    #num {
      padding: 10px 15px;
      font-size: 1.2rem;
      border: 2px solid #ffb6d4;
      border-radius: 12px;
      outline: none;
      width: 260px;
      background: #fff;
      transition: 0.2s;
    }

    #num:focus {
      border-color: #ff7aa8;
      box-shadow: 0 0 5px #ffb6d4;
    }

    button {
      padding: 10px 20px;
      margin-left: 10px;
      font-size: 1.1rem;
      background-color: #ff9ecb;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      color: white;
      transition: 0.2s;
    }

    button:hover {
      background-color: #ff7aa8;
      transform: scale(1.05);
    }

    .reset {
      background-color: silver;
    }
    .reset:hover {
      background-color: red;
    }

    #result {
      font-family: "Segoe UI", "Arial", sans-serif;
      line-height: 1.6;
      font-size: 1.5rem;
      color:hotpink;
      word-break: break-all;
    }

    .box {
      background: snow;
      display: inline-block;
      padding: 30px 40px;
      border-radius: 20px;
      box-shadow: 0 4px 12px rgba(255, 150, 180, 0.5);
    }

    button.glow {
      animation: popGlow 0.25s ease-out;
    }

    @keyframes popGlow {
      0% {
          transform: scale(1);
          box-shadow: 0 0 0px rgba(255, 150, 200, 0.0);
      }
      50% {
          transform: scale(1.12);
          box-shadow: 0 0 15px rgba(255, 150, 200, 0.6);
      }
      100% {
          transform: scale(1);
          box-shadow: 0 0 0px rgba(255, 150, 200, 0.0);
      }
    }

    /* ãã®å ´ã§ãã‚‹ãã‚‹å›ã‚‹èŠ±ã³ã‚‰ */
    .loader {
      display: none;
      margin: 20px auto;
      width: 60px;
      height: 60px;
      position: relative;
    }

    .loader span {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2.5rem;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: translate(-50%, -50%) rotate(0deg); }
      to   { transform: translate(-50%, -50%) rotate(360deg); }
    }

    /* å·¦ä¸Šã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ */
  #menuButton {
    position: fixed;
    top: 15px;
    left: 15px;
    background: #ff9ecb;
    color: white;
    font-size: 1.8rem;
    padding: 8px 14px;
    border-radius: 10px;
    cursor: pointer;
    z-index: 1000;
    box-shadow: 0 3px 8px rgba(255, 150, 180, 0.4);
    transition: 0.2s;
  }

  #menuButton:hover {
    background: #ff7aa8;
    transform: scale(1.05);
  }

  /* ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼æœ¬ä½“ */
  #sideMenu {
    position: fixed;
    top: 0;
    left: -250px; /* åˆæœŸã¯éš ã™ */
    width: 250px;
    height: 100%;
    background: snow;
    box-shadow: 3px 0 10px rgba(0,0,0,0.2);
    padding: 20px;
    transition: 0.3s;
    z-index: 999;
    border-radius: 0 15px 15px 0;
  }

  #sideMenu h3 {
    color: #ff7aa8;
    margin-bottom: 15px;
  }

  /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼å†…ã®ãƒœã‚¿ãƒ³ */
  #sideMenu button {
    display: block;
    width: 100%;
    margin: 10px 0;
  }

  /* èƒŒæ™¯ã®æš—ã„ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
  #menuOverlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.3);
    display: none;
    z-index: 500;
  }

    /* ===== ã‚¹ãƒãƒ›ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ ===== */
    @media (max-width: 600px) {

      body {
        padding-top: 20px;
      }

      .box {
        width: 95%;
        padding: 20px 15px;
        border-radius: 15px;
      }

      h2 {
        font-size: 1.6rem;
        margin-bottom: 15px;
      }

      #num {
        width: 90%;
        font-size: 1.1rem;
        padding: 10px;
      }

      button {
        display: block;
        width: 90%;
        margin: 8px auto;
        font-size: 1.1rem;
        padding: 12px 0;
      }

      #result {
        font-size: 1.3rem;
        margin-top: 15px;
      }

      .loader {
        width: 50px;
        height: 50px;
      }

      .loader span {
        font-size: 2rem;
      }
    }

  </style>
</head>
<body>

<!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ -->
<div id="menuButton">â˜°</div>

<!-- ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
<div id="sideMenu">
  <h3>ğŸŒ¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ ğŸŒ¸</h3>
  
</div>

<!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼å±•é–‹æ™‚ã®èƒŒæ™¯ -->
<div id="menuOverlay"></div>

<div class="box">
  <h2>ğŸŒ¸ ç´ æ•°ã«é–¢ã™ã‚‹ãƒ„ãƒ¼ãƒ« ğŸŒ¸</h2>

  <input id="num" type="text" placeholder="æ•´æ•°ã‚’å…¥åŠ›ã—ã¦ã­">
  <button onclick="run()">ç´ å› æ•°åˆ†è§£</button>
  <button onclick="runNthPrime()">nç•ªç›®ã®ç´ æ•°</button>
  <button onclick="runCountPrime()">nä»¥ä¸‹ã®ç´ æ•°ã®å€‹æ•°</button>
  <button onclick="runSumPrime()">nä»¥ä¸‹ã®ç´ æ•°ã®å’Œ</button>
  <button onclick="resetAll()" class = "reset">ãƒªã‚»ãƒƒãƒˆ</button>

  <p id="result"></p>

  <div class="loader" id="loader">
    <span>ğŸŒ¸</span>
  </div>

</div>

<script>
// ç´ å› æ•°åˆ†è§£ã‚³ãƒ¼ãƒ‰
function printPrimeFactorization(inputStr) {
  // BigInt ã«å¤‰æ›
  let n;
  try {
    n = BigInt(inputStr);
  } catch {
    return "ğŸŒ¸ æ­£ã—ã„æ•´æ•°ã‚’å…¥åŠ›ã—ã¦ã­ ğŸŒ¸";
  }

  const sup = ["â°","Â¹","Â²","Â³","â´","âµ","â¶","â·","â¸","â¹"];
  const toSup = (x) => String(x).split("").map(c => sup[Number(c)]).join("");

  // 1ä»¥ä¸‹ãªã‚‰ã‚¨ãƒ©ãƒ¼
  if (n <= 1n) {
    return `ğŸŒ¸ ${n} ã¯ç´ å› æ•°åˆ†è§£ã§ãã¾ã›ã‚“ ğŸŒ¸`;
  }

  // ç´ æ•°ãƒã‚§ãƒƒã‚¯
  function isPrime(x) {
    if (x <= 1n) return false;
    for (let i = 2n; i * i <= x; i++) {
      if (x % i === 0n) return false;
    }
    return true;
  }

  if (isPrime(n)) {
    return `ğŸŒ¸ ${n} ã¯ç´ æ•°ã§ã™ ğŸŒ¸`;
  }

  // ç´ å› æ•°åˆ†è§£
  let original = n;
  let res = [];

  for (let i = 2n; i * i <= n; i++) {
    if (n % i === 0n) {
      let ex = 0;
      while (n % i === 0n) {
        ex++;
        n /= i;
      }
      res.push([i, ex]);
    }
  }

  if (n !== 1n) {
    res.push([n, 1]);
  }

  let output = `${original} = `;
  output += res.map(([p, e]) => {
    return e === 1 ? `${p}` : `${p}${toSup(e)}`;
  }).join(" Ã— ");

  return output;
}

function run() {
  const btn = document.querySelector("button");
  const loader = document.getElementById("loader");
  const result = document.getElementById("result");

  // å…‰ã‚‹æ¼”å‡º
  btn.classList.add("glow");
  setTimeout(() => btn.classList.remove("glow"), 250);

  const inputStr = document.getElementById("num").value.trim();

  // ãƒ­ãƒ¼ãƒ‰ä¸­è¡¨ç¤º
  result.textContent = "â³ ãƒ­ãƒ¼ãƒ‰ä¸­â€¦";
  loader.style.display = "block";

  // UIæ›´æ–°ã®ãŸã‚å°‘ã—é…ã‚‰ã›ã¦è¨ˆç®—é–‹å§‹
  setTimeout(() => {
    result.textContent = printPrimeFactorization(inputStr);
    loader.style.display = "none"; // çµ‚ã‚ã£ãŸã‚‰æ¶ˆã™
  }, 50);
}

// è¶…é«˜é€Ÿ nç•ªç›®ã®ç´ æ•°ï¼ˆSegmented Sieve + å¥‡æ•°ã®ã¿ï¼‰
async function nthPrimeUltra(n) {
  n = Number(n);
  if (!Number.isInteger(n) || n < 1) {
    return "ğŸŒ¸ 1ä»¥ä¸Šã®æ•´æ•°ã‚’å…¥ã‚Œã¦ã­ ğŸŒ¸";
  }

  if (n === 1) return "ğŸŒ¸ 1ç•ªç›®ã®ç´ æ•°ã¯ 2 ã§ã™ ğŸŒ¸";

  // --- ä¸Šé™æ¨å®š ---
  const nn = n;
  let limit = Math.ceil(nn * (Math.log(nn) + Math.log(Math.log(nn))));
  limit = Math.floor(limit * 2.0);
  if (limit < 100) limit = 100;

  const segmentSize = 5_000_000; // 5ç™¾ä¸‡ãšã¤å‡¦ç†
  const sqrtLimit = Math.floor(Math.sqrt(limit));

  // å°ã•ã„ç´ æ•°ã‚’é€šå¸¸ã®ç¯©ã§ä½œã‚‹
  const small = new Uint8Array(sqrtLimit + 1);
  const basePrimes = [];

  for (let i = 2; i <= sqrtLimit; i++) {
    if (!small[i]) {
      basePrimes.push(i);
      for (let j = i * 2; j <= sqrtLimit; j += i) {
        small[j] = 1;
      }
    }
  }

  let count = 1; // 2 ã¯ã‚«ã‚¦ãƒ³ãƒˆæ¸ˆã¿

  // --- åˆ†å‰²ç¯© ---
  for (let low = 3; low <= limit; low += segmentSize) {
    const high = Math.min(low + segmentSize - 1, limit);
    const size = Math.floor((high - low) / 2) + 1;
    const segment = new Uint8Array(size);

    for (const p of basePrimes) {
      let start = Math.max(p * p, Math.ceil(low / p) * p);
      if (start % 2 === 0) start += p;

      for (let j = start; j <= high; j += 2 * p) {
        segment[Math.floor((j - low) / 2)] = 1;
      }
    }

    for (let i = 0; i < size; i++) {
      if (!segment[i]) {
        count++;
        if (count === n) {
          const prime = low + i * 2;
          return `ğŸŒ¸ ${n} ç•ªç›®ã®ç´ æ•°ã¯ ${prime} ã§ã™ ğŸŒ¸`;
        }
      }
    }

    // UI ã‚’æ­¢ã‚ãªã„ãŸã‚ã®ä¼‘æ†©
    await new Promise(r => setTimeout(r));
  }

  return "ğŸŒ¸ ç¯„å›²ãŒè¶³ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼ˆnãŒå¤§ãã™ãã‚‹ã‹ã‚‚ï¼‰ğŸŒ¸";
}

function runNthPrime() {
  const btn = document.querySelector("button[onclick='runNthPrime()']");
  const loader = document.getElementById("loader");
  const result = document.getElementById("result");
  const inputStr = document.getElementById("num").value.trim();

  btn.classList.add("glow");
  setTimeout(() => btn.classList.remove("glow"), 250);

  result.textContent = "â³ ãƒ­ãƒ¼ãƒ‰ä¸­â€¦";
  loader.style.display = "block";

  setTimeout(async () => {
    result.textContent = await nthPrimeUltra(inputStr);
    loader.style.display = "none";
  }, 50);
}

async function countPrimesUnder(n) {
  n = Number(n);
  if (!Number.isInteger(n) || n < 2) {
    return "ğŸŒ¸ 2ä»¥ä¸Šã®æ•´æ•°ã‚’å…¥ã‚Œã¦ã­ ğŸŒ¸";
  }

  // 2 ã¯ç´ æ•°
  let count = 1;

  // å¶æ•°ã‚’é™¤ã
  const limit = n;
  const segmentSize = 5_000_000;
  const sqrtLimit = Math.floor(Math.sqrt(limit));

  // å°ã•ã„ç´ æ•°ã‚’é€šå¸¸ã®ç¯©ã§ä½œã‚‹
  const small = new Uint8Array(sqrtLimit + 1);
  const basePrimes = [];

  for (let i = 2; i <= sqrtLimit; i++) {
    if (!small[i]) {
      basePrimes.push(i);
      for (let j = i * 2; j <= sqrtLimit; j += i) {
        small[j] = 1;
      }
    }
  }

  // åˆ†å‰²ç¯©ã§ n ä»¥ä¸‹ã®ç´ æ•°ã‚’æ•°ãˆã‚‹
  for (let low = 3; low <= limit; low += segmentSize) {
    const high = Math.min(low + segmentSize - 1, limit);
    const size = Math.floor((high - low) / 2) + 1;
    const segment = new Uint8Array(size);

    for (const p of basePrimes) {
      let start = Math.max(p * p, Math.ceil(low / p) * p);
      if (start % 2 === 0) start += p;

      for (let j = start; j <= high; j += 2 * p) {
        segment[Math.floor((j - low) / 2)] = 1;
      }
    }

    for (let i = 0; i < size; i++) {
      if (!segment[i]) {
        count++;
      }
    }

    // UI ã‚’æ­¢ã‚ãªã„
    await new Promise(r => setTimeout(r));
  }

  return `ğŸŒ¸ ${n} ä»¥ä¸‹ã®ç´ æ•°ã®å€‹æ•°ã¯ ${count} å€‹ã§ã™ ğŸŒ¸`;
}

function runCountPrime() {
  const btn = document.querySelector("button[onclick='runCountPrime()']");
  const loader = document.getElementById("loader");
  const result = document.getElementById("result");
  const inputStr = document.getElementById("num").value.trim();

  btn.classList.add("glow");
  setTimeout(() => btn.classList.remove("glow"), 250);

  result.textContent = "â³ ãƒ­ãƒ¼ãƒ‰ä¸­â€¦";
  loader.style.display = "block";

  setTimeout(async () => {
    result.textContent = await countPrimesUnder(inputStr);
    loader.style.display = "none";
  }, 50);
}

async function sumPrimesUnder(n) {
  n = Number(n);
  if (!Number.isInteger(n) || n < 2) {
    return "ğŸŒ¸ 2ä»¥ä¸Šã®æ•´æ•°ã‚’å…¥ã‚Œã¦ã­ ğŸŒ¸";
  }

  let sum = 2; // 2 ã¯ç´ æ•°
  const limit = n;
  const segmentSize = 5_000_000;
  const sqrtLimit = Math.floor(Math.sqrt(limit));

  // å°ã•ã„ç´ æ•°ã‚’é€šå¸¸ã®ç¯©ã§ä½œã‚‹
  const small = new Uint8Array(sqrtLimit + 1);
  const basePrimes = [];

  for (let i = 2; i <= sqrtLimit; i++) {
    if (!small[i]) {
      basePrimes.push(i);
      for (let j = i * 2; j <= sqrtLimit; j += i) {
        small[j] = 1;
      }
    }
  }

  // åˆ†å‰²ç¯©ã§ n ä»¥ä¸‹ã®ç´ æ•°ã®å’Œã‚’æ±‚ã‚ã‚‹
  for (let low = 3; low <= limit; low += segmentSize) {
    const high = Math.min(low + segmentSize - 1, limit);
    const size = Math.floor((high - low) / 2) + 1;
    const segment = new Uint8Array(size);

    for (const p of basePrimes) {
      let start = Math.max(p * p, Math.ceil(low / p) * p);
      if (start % 2 === 0) start += p;

      for (let j = start; j <= high; j += 2 * p) {
        segment[Math.floor((j - low) / 2)] = 1;
      }
    }

    for (let i = 0; i < size; i++) {
      if (!segment[i]) {
        sum += low + i * 2;
      }
    }

    await new Promise(r => setTimeout(r));
  }

  return `ğŸŒ¸ ${n} ä»¥ä¸‹ã®ç´ æ•°ã®å’Œã¯ ${sum} ã§ã™ ğŸŒ¸`;
}

function runSumPrime() {
  const btn = document.querySelector("button[onclick='runSumPrime()']");
  const loader = document.getElementById("loader");
  const result = document.getElementById("result");
  const inputStr = document.getElementById("num").value.trim();

  btn.classList.add("glow");
  setTimeout(() => btn.classList.remove("glow"), 250);

  result.textContent = "â³ ãƒ­ãƒ¼ãƒ‰ä¸­â€¦";
  loader.style.display = "block";

  setTimeout(async () => {
    result.textContent = await sumPrimesUnder(inputStr);
    loader.style.display = "none";
  }, 50);
}

// ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ ä¸Šã«è¿½è¨˜
function resetAll() {
  const input = document.getElementById("num");
  const result = document.getElementById("result");
  const loader = document.getElementById("loader");

  input.value = "";          // å…¥åŠ›æ¬„ã‚’ç©ºã«
  result.textContent = "";   // çµæœã‚’æ¶ˆã™
  loader.style.display = "none"; // ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚’æ¶ˆã™
}

// ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹é–‰
const menuButton = document.getElementById("menuButton");
const sideMenu = document.getElementById("sideMenu");
const menuOverlay = document.getElementById("menuOverlay");

menuButton.onclick = () => {
  sideMenu.style.left = "0";
  menuOverlay.style.display = "block";
};

menuOverlay.onclick = () => {
  sideMenu.style.left = "-250px";
  menuOverlay.style.display = "none";
};

</script>

</body>
</html>


